# Test WSL Package with multiple distributions
- name: Test WSL Package scenarios
  vars:
    test_distributions:
      - name: Ubuntu-20.04    # Debian-based
        id: Ubuntu
      - name: Alpine          # Alpine-based
        id: Alpine
      - name: Fedora          # Red Hat-based
        id: Fedora

  block:
    - name: Run tests for each distribution
      loop: "{{ test_distributions }}"
      loop_control:
        loop_var: distribution
      block:
        - name: Run minimum scenario for {{ distribution.name }}
          ansible.builtin.include_tasks:
            file: minimum.yml
          vars:
            distribution_name: "{{ distribution.name }}"
            distribution_id: "{{ distribution.id }}"

        - name: Run standard scenario for {{ distribution.name }}
          ansible.builtin.include_tasks:
            file: standard.yml
          vars:
            distribution_name: "{{ distribution.name }}"
            distribution_id: "{{ distribution.id }}"

  rescue:
    - name: Debug actual output if any test failed
      ansible.builtin.debug:
        msg: "{{ wsl_package_actual }}"
